---
layout: post
title: Redis知识
subtitle: Part I：基础知识整理
cover-img: /assets/img/path.jpg
tags: [database]
categories: ['DataBase']
---

#Redis知识整理


## 第一章 Redis中的数据结构


Redis中的数据结构包含SDS、链表、字典、跳表、整数集合、压缩列表和对象


### 1. SDS( Simple dynamic String)

redis键值对中的**key都是string类型的**，redis底层是用C写的，对于String并没有直接使用C的字符数组，而是自己封装了一个sds类型.

```c
    struct sdshdr{
        //记录已使用的长度
        int len;
        //记录未使用的长度
        int free;
        //字节数组
        char buf[];

    };

```


**Why SDS?**


    - C的字符串api是不安全，因为在使用字符数组后，需要跟踪内存的分配，在使用之前，需要预分配内存空间，否则会有缓冲区溢出，用完一个字符串，需要回收，否则会有内存泄漏
    
    
    -SDS可以将分配内存的事封装，不让调用方得知
    
    
    -SDS采用空间预分配，惰性回收
    
      - 每创建一个新的String，不按实际大小分配，而是预分配更多内存。当字符串截断时，也不是立刻回收内存，而是减少len值，增加free值。字符串插入时，先看free够不够，
      不够再分配。这样减少了内存分配回收次数
      
      ![](https://camo.githubusercontent.com/a15b46e08382dc66e8c46aa9d5a5ac8f9cc20b60/68747470733a2f2f696d672d626c6f672e6373646e2e6e65742f3230313730383136313431373230393039)



